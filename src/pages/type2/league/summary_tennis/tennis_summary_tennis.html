<ion-header>
  <ion-navbar color="primary">
    <ion-title>ðŸŽ¾ Tennis Summary</ion-title>
  </ion-navbar>
</ion-header>

<ion-content class="tennis-summary-content">
  <!-- Match Header -->
  <div class="match-header">
    <div class="match-title">
      <h2>{{matchTitle}}</h2>
    </div>
    <div class="match-details">
      <div class="detail-item">
        <ion-icon name="calendar"></ion-icon>
        <span>{{matchDate}}</span>
      </div>
      <div class="detail-item" *ngIf="matchLocation">
        <ion-icon name="pin"></ion-icon>
        <span>{{matchLocation}}</span>
      </div>
    </div>
  </div>

  <!-- Score Section -->
  <div class="score-section">
    <!-- Home Team -->
    <div class="team-card" (click)="gotoSetInputPage(true)">
      <div class="team-logo-container">
        <img class="team-logo" [src]="homeTeamLogo" [alt]="homeTeamName + ' logo'">
        <!-- <ion-icon name="create" class="edit-icon"></ion-icon> -->
      </div>
      <div class="team-details">
        <div class="team-name">{{homeTeamName}}</div>
        <div class="team-score">{{homeScore}}</div>
      </div>
    </div>

    <!-- VS Section -->
    <div class="vs-container" (click)="gotoResultInputPage()">
      <div class="vs-text">VS</div>
      <ion-icon name="create" class="vs-edit-icon"></ion-icon>
    </div>

    <!-- Away Team -->
    <div class="team-card" (click)="gotoSetInputPage(false)">
      <div class="team-details away">
        <div class="team-name">{{awayTeamName}}</div>
        <div class="team-score">{{awayScore}}</div>
      </div>
      <div class="team-logo-container">
        <img class="team-logo" [src]="awayTeamLogo" [alt]="awayTeamName + ' logo'">
        <!-- <ion-icon name="create" class="edit-icon"></ion-icon> -->
      </div>
    </div>
  </div>

  <!-- Set Scores Display -->
  <div class="set-scores-section" *ngIf="result_json && result_json.SET_SCORES && result_json.SET_SCORES.length > 0"
    (click)="gotoSetInputPage(true)">
    <div class="section-header">
      <ion-icon name="trophy"></ion-icon>
      <h4>Set Scores</h4>
    </div>
    <div class="sets-grid">
      <div class="set-item" *ngFor="let set of result_json.SET_SCORES; let i = index">
        <div class="set-number">Set {{i + 1}}</div>
        <div class="set-score">{{set.SCORE}}</div>
      </div>
    </div>
  </div>

  <!-- Match Stats Section -->
  <div class="stats-section" *ngIf="result_json">
    <div class="section-header">
      <ion-icon name="analytics"></ion-icon>
      <h4>Match Statistics</h4>
    </div>

    <div class="stats-grid">
      <!-- Aces Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="flash" color="warning"></ion-icon>
          <span class="stat-title">Aces</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.ACES, result_json.AWAY_TEAM.ACES, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.ACES || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.ACES, result_json.AWAY_TEAM.ACES, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.ACES || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Double Faults Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="warning" color="danger"></ion-icon>
          <span class="stat-title">Double Faults</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.DOUBLE_FAULTS, result_json.AWAY_TEAM.DOUBLE_FAULTS, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.DOUBLE_FAULTS || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.DOUBLE_FAULTS, result_json.AWAY_TEAM.DOUBLE_FAULTS, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.DOUBLE_FAULTS || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- First Serve Percentage Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="checkmark-circle" color="success"></ion-icon>
          <span class="stat-title">First Serve %</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.FIRST_SERVE_PERCENTAGE, result_json.AWAY_TEAM.FIRST_SERVE_PERCENTAGE, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.FIRST_SERVE_PERCENTAGE || '0'}}%</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.FIRST_SERVE_PERCENTAGE, result_json.AWAY_TEAM.FIRST_SERVE_PERCENTAGE, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.FIRST_SERVE_PERCENTAGE || '0'}}%</span>
          </div>
        </div>
      </div>

      <!-- Unforced Errors Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="close-circle" color="danger"></ion-icon>
          <span class="stat-title">Unforced Errors</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.UNFORCED_ERRORS, result_json.AWAY_TEAM.UNFORCED_ERRORS, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.UNFORCED_ERRORS || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.UNFORCED_ERRORS, result_json.AWAY_TEAM.UNFORCED_ERRORS, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.UNFORCED_ERRORS || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Break Points Won Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="trophy" color="warning"></ion-icon>
          <span class="stat-title">Break Points Won</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.BREAK_POINTS_WON, result_json.AWAY_TEAM.BREAK_POINTS_WON, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.BREAK_POINTS_WON || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.BREAK_POINTS_WON, result_json.AWAY_TEAM.BREAK_POINTS_WON, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.BREAK_POINTS_WON || '0'}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<!-- Home Team Stats Popup -->
<div class="custom-popup" *ngIf="isHomeStatsPopupVisible && result_json">
  <div class="popup-container">
    <div class="popup-header">
      <h3>Update {{homeTeamName}} Stats</h3>
      <button class="close-button" (click)="isHomeStatsPopupVisible=false">Ã—</button>
    </div>

    <div class="popup-content">
      <ion-item class="input_item">
        <ion-label>Aces</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.ACES" min="0"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Double Faults</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.DOUBLE_FAULTS"
          min="0"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>First Serve %</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.FIRST_SERVE_PERCENTAGE" min="0"
          max="100"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Unforced Errors</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.UNFORCED_ERRORS"
          min="0"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Break Points Won</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.BREAK_POINTS_WON"
          min="0"></ion-input>
      </ion-item>
    </div>

    <div class="popup-buttons">
      <button ion-button class="timekare-primary-btn" (click)="isHomeStatsPopupVisible=false">Cancel</button>
      <button ion-button class="timekare-primary-btn" (click)="updateHomeTeamStats()">Update</button>
    </div>
  </div>
</div>

<!-- Away Team Stats Popup -->
<div class="custom-popup" *ngIf="isAwayStatsPopupVisible && result_json">
  <div class="popup-container">
    <div class="popup-header">
      <h3>Update {{awayTeamName}} Stats</h3>
      <button class="close-button" (click)="isAwayStatsPopupVisible=false">Ã—</button>
    </div>

    <div class="popup-content">
      <ion-item class="input_item">
        <ion-label>Aces</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.ACES" min="0"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Double Faults</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.DOUBLE_FAULTS"
          min="0"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>First Serve %</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.FIRST_SERVE_PERCENTAGE" min="0"
          max="100"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Unforced Errors</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.UNFORCED_ERRORS"
          min="0"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Break Points Won</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.BREAK_POINTS_WON"
          min="0"></ion-input>
      </ion-item>
    </div>

    <div class="popup-buttons">
      <button ion-button class="timekare-primary-btn" (click)="isAwayStatsPopupVisible=false">Cancel</button>
      <button ion-button class="timekare-primary-btn" (click)="updateAwayTeamStats()">Update</button>
    </div>
  </div>
</div>