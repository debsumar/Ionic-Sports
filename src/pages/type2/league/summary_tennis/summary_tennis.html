<!--
  Generated template for the SummaryTennisPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
    <ion-navbar>
        <ion-title>Tennis Summary</ion-title>
    </ion-navbar>
</ion-header>

<ion-content>
    <div class="match-info">
        <p class="largetext">{{matchObj?.match_title}}</p>
        <ion-row>
            <p style="margin: 0; display: flex; align-items: center">
                <span><ion-icon class="smalltext" name="md-calendar" style="color: #2b92bb"></ion-icon></span>
                <span class="smalltext" style="font-weight: 600;">{{matchObj?.start_date}}</span>
            </p>
        </ion-row>
        <div style="display: flex; align-items: center;">
            <ion-icon class="smalltext" name="pin" style="color: #2b92bb"></ion-icon>
            <p class="smalltext">{{matchObj?.location_name}}</p>
        </div>

        <!-- Tennis Score Display -->
        <div style="display: flex;">
            <ion-col col-3 (click)="gotoSetScoreInputPage()">
                <img class="teamLogo"
                    [src]="homeTeamObj?.parentclubteam?.logo_url || 'assets/imgs/default-team-logo.png'">
                <!-- Set Scores Display for Home Team -->
                <div *ngIf="result_json?.SET_SCORES && result_json.SET_SCORES.length > 0">
                    <p class="setScoreInfo" *ngFor="let setScore of result_json.SET_SCORES">
                        Set {{setScore?.SET_NUMBER}}: {{setScore?.SCORE?.split('-')[0]}}
                    </p>
                </div>
                <ion-icon name="create" style="color: rgba(0,0,0,0.50); font-size: 12px;"></ion-icon>
            </ion-col>

            <ion-row text-center (click)="gotoResultInputPage()">
                <ion-col style="padding: 0px;display: ruby;">
                    <ion-row style="color: green;font-size: 30px;">{{homeSetsWon}}</ion-row>
                    <ion-row style="font-size: 12px;">{{homeTeamObj?.parentclubteam?.teamName}}</ion-row>
                </ion-col>
                <ion-col>
                    <ion-icon name="create" style="color: rgba(0,0,0,0.50); font-size: 12px;"></ion-icon>
                    <p style="margin: 0;">-</p>
                </ion-col>
                <ion-col style="padding: 0px;display: ruby;">
                    <ion-row style="color: red; font-size: 30px;">{{awaySetsWon}}</ion-row>
                    <ion-row style="font-size: 12px;">{{awayTeamObj?.parentclubteam?.teamName}}</ion-row>
                </ion-col>
            </ion-row>

            <ion-col col-3 (click)="gotoSetScoreInputPage()">
                <img class="teamLogo"
                    [src]="awayTeamObj?.parentclubteam?.logo_url || 'assets/imgs/default-team-logo.png'">
                <!-- Set Scores Display for Away Team -->
                <div *ngIf="result_json?.SET_SCORES && result_json.SET_SCORES.length > 0">
                    <p class="setScoreInfo" *ngFor="let setScore of result_json.SET_SCORES">
                        Set {{setScore?.SET_NUMBER}}: {{setScore?.SCORE?.split('-')[1]}}
                    </p>
                </div>
                <ion-icon name="create" style="color: rgba(0,0,0,0.50); font-size: 12px;"></ion-icon>
            </ion-col>
        </div>

        <!-- Set Scores Summary -->
        <div *ngIf="result_json?.SET_SCORES && result_json.SET_SCORES.length > 0" class="set-scores-summary">
            <h4 style="color: #f6ae4d; margin: 10px 0;">Set Scores</h4>
            <div class="set-score-row" *ngFor="let setScore of result_json.SET_SCORES">
                <span class="set-number">Set {{setScore?.SET_NUMBER}}:</span>
                <span class="set-score">{{setScore?.SCORE}}</span>
                <span class="set-winner"
                    [ngClass]="{'home-winner': setScore?.WINNER === 'HOME', 'away-winner': setScore?.WINNER === 'AWAY'}">
                    ({{setScore?.WINNER === 'HOME' ? homeTeamObj?.parentclubteam?.teamName :
                    awayTeamObj?.parentclubteam?.teamName}})
                </span>
            </div>
        </div>

        <ion-card (click)="gotoPotmPage()" style="width: 100%;margin-left: 0px;">
            <ion-row>
                <ion-col col-3>
                    <p>POTM</p>
                </ion-col>
                <ion-col col-9 *ngIf="potmDisplayNames && potmDisplayNames.length > 0">
                    <ion-row style="margin: 0;padding: 0;">
                        <p style="padding-right: 8px;color: #2b92bb"
                            *ngFor="let potm of potmDisplayNames; let last = last">
                            {{potm.PLAYER}}<span *ngIf="!last">, </span>
                        </p>
                    </ion-row>
                </ion-col>
                <ion-col col-9 *ngIf="!potmDisplayNames || potmDisplayNames.length === 0">
                    <ion-row style="margin: 0;padding: 0;">
                        <p style="padding-right: 8px;color: #999;">Select POTM</p>
                    </ion-row>
                </ion-col>
            </ion-row>
        </ion-card>
    </div>

    <div class="stats-section">
        <div style="text-align: center;margin: 5px;">
            <h3 style="color: #f6ae4d;">Match Stats</h3>
        </div>
        <p style="text-align: center;color: #f6ae4d;margin: 0px;">Winners</p>

        <div class="chartDiv">
            <ion-col style="margin: 0; padding: 0" (click)="isHomeStatsPopupVisible = true">
                <span style="color: green; font-size: 20px;">{{homeWinners}}</span>
                <ion-icon name="create"
                    style="color: rgba(0,0,0,0.50); font-size: 16px; padding-right:20px;"></ion-icon>
            </ion-col>

            <canvas #doughnutCanvas width="200" height="200"></canvas>

            <ion-col style="margin: 0; padding: 0" (click)="isAwayStatsPopupVisible = true">
                <span style="color: red; font-size: 20px;">{{awayWinners}}</span>
                <ion-icon name="create" style="color: rgba(0,0,0,0.50); font-size: 16px;"></ion-icon>
            </ion-col>
        </div>

        <div class="stat-row" *ngIf="result_json">
            <!-- Aces Section -->
            <div class="stat-section">
                <p class="stat-title">Aces</p>
                <ion-row>
                    <ion-col>
                        <!-- Home Team Bar -->
                        <ion-row (click)="isHomeStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill rma" [style.width.%]="getStatPercentage('ACES', 'HOME_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: green;">{{getHomeTeamStat('ACES')}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- Away Team Bar -->
                        <ion-row (click)="isAwayStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill atm" [style.width.%]="getStatPercentage('ACES', 'AWAY_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: red;">{{getAwayTeamStat('ACES')}}</span>
                            </ion-col>
                        </ion-row>
                    </ion-col>
                </ion-row>
            </div>

            <!-- Double Faults Section -->
            <div class="stat-section" *ngIf="result_json">
                <p class="stat-title">Double Faults</p>
                <ion-row>
                    <ion-col>
                        <!-- Home Team Bar -->
                        <ion-row (click)="isHomeStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill rma"
                                        [style.width.%]="getStatPercentage('DOUBLE_FAULTS', 'HOME_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: green;">{{getHomeTeamStat('DOUBLE_FAULTS')}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- Away Team Bar -->
                        <ion-row (click)="isAwayStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill atm"
                                        [style.width.%]="getStatPercentage('DOUBLE_FAULTS', 'AWAY_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: red;">{{getAwayTeamStat('DOUBLE_FAULTS')}}</span>
                            </ion-col>
                        </ion-row>
                    </ion-col>
                </ion-row>
            </div>

            <!-- Winners Section -->
            <div class="stat-section" *ngIf="result_json">
                <p class="stat-title">Winners</p>
                <ion-row>
                    <ion-col>
                        <!-- Home Team Bar -->
                        <ion-row (click)="isHomeStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill rma"
                                        [style.width.%]="getStatPercentage('WINNERS', 'HOME_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: green;">{{getHomeTeamStat('WINNERS')}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- Away Team Bar -->
                        <ion-row (click)="isAwayStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill atm"
                                        [style.width.%]="getStatPercentage('WINNERS', 'AWAY_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: red;">{{getAwayTeamStat('WINNERS')}}</span>
                            </ion-col>
                        </ion-row>
                    </ion-col>
                </ion-row>
            </div>

            <!-- Unforced Errors Section -->
            <div class="stat-section" *ngIf="result_json">
                <p class="stat-title">Unforced Errors</p>
                <ion-row>
                    <ion-col>
                        <!-- Home Team Bar -->
                        <ion-row (click)="isHomeStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill rma"
                                        [style.width.%]="getStatPercentage('UNFORCED_ERRORS', 'HOME_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: green;">{{getHomeTeamStat('UNFORCED_ERRORS')}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- Away Team Bar -->
                        <ion-row (click)="isAwayStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill atm"
                                        [style.width.%]="getStatPercentage('UNFORCED_ERRORS', 'AWAY_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: red;">{{getAwayTeamStat('UNFORCED_ERRORS')}}</span>
                            </ion-col>
                        </ion-row>
                    </ion-col>
                </ion-row>
            </div>

            <!-- Break Points Won Section -->
            <div class="stat-section" *ngIf="result_json">
                <p class="stat-title">Break Points Won</p>
                <ion-row>
                    <ion-col>
                        <!-- Home Team Bar -->
                        <ion-row (click)="isHomeStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill rma"
                                        [style.width.%]="getStatPercentage('BREAK_POINTS_WON', 'HOME_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: green;">{{getHomeTeamStat('BREAK_POINTS_WON')}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- Away Team Bar -->
                        <ion-row (click)="isAwayStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill atm"
                                        [style.width.%]="getStatPercentage('BREAK_POINTS_WON', 'AWAY_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: red;">{{getAwayTeamStat('BREAK_POINTS_WON')}}</span>
                            </ion-col>
                        </ion-row>
                    </ion-col>
                </ion-row>
            </div>

            <!-- Games Won Section -->
            <div class="stat-section" *ngIf="result_json">
                <p class="stat-title">Games Won</p>
                <ion-row>
                    <ion-col>
                        <!-- Home Team Bar -->
                        <ion-row (click)="isHomeStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill rma"
                                        [style.width.%]="getStatPercentage('GAMES_WON', 'HOME_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: green;">{{getHomeTeamStat('GAMES_WON')}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- Away Team Bar -->
                        <ion-row (click)="isAwayStatsPopupVisible = true">
                            <ion-col col-10 style="padding: 0; margin: 0;">
                                <div class="barDiv">
                                    <div class="bar-fill atm"
                                        [style.width.%]="getStatPercentage('GAMES_WON', 'AWAY_TEAM')">
                                    </div>
                                </div>
                            </ion-col>
                            <ion-col col-2 style="padding: 0; margin: 0;" text-center>
                                <span style="color: red;">{{getAwayTeamStat('GAMES_WON')}}</span>
                            </ion-col>
                        </ion-row>
                    </ion-col>
                </ion-row>
            </div>
        </div>
    </div>
</ion-content>

<!-- Custom popup for home team stats update -->
<div class="custom-popup" *ngIf="isHomeStatsPopupVisible && result_json">
    <div class="popup-container">
        <div class="popup-header">
            <h3>Update {{homeTeamObj.parentclubteam.teamName}} Stats</h3>
            <button class="close-button" (click)="isHomeStatsPopupVisible=false">×</button>
        </div>

        <div class="popup-content">
            <ion-item class="input_item">
                <ion-label>Sets Won</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.SETS_WON"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Games Won</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.GAMES_WON"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Aces</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.ACES"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Double Faults</ion-label>
                <ion-input type="number" class="textright"
                    [(ngModel)]="result_json.HOME_TEAM.DOUBLE_FAULTS"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>First Serve %</ion-label>
                <ion-input type="text" class="textright"
                    [(ngModel)]="result_json.HOME_TEAM.FIRST_SERVE_PERCENTAGE"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Winners</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.WINNERS"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Unforced Errors</ion-label>
                <ion-input type="number" class="textright"
                    [(ngModel)]="result_json.HOME_TEAM.UNFORCED_ERRORS"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Break Points Won</ion-label>
                <ion-input type="number" class="textright"
                    [(ngModel)]="result_json.HOME_TEAM.BREAK_POINTS_WON"></ion-input>
            </ion-item>
        </div>

        <div class="popup-buttons">
            <button ion-button class="timekare-primary-btn" (click)="isHomeStatsPopupVisible=false">Cancel</button>
            <button ion-button class="timekare-primary-btn" (click)="updateHomeTeamStats()">Update</button>
        </div>
    </div>
</div>

<!-- Custom popup for away team stats update -->
<div class="custom-popup" *ngIf="isAwayStatsPopupVisible && result_json">
    <div class="popup-container">
        <div class="popup-header">
            <h3>Update {{awayTeamObj.parentclubteam.teamName}} Stats</h3>
            <button class="close-button" (click)="isAwayStatsPopupVisible=false">×</button>
        </div>

        <div class="popup-content">
            <ion-item class="input_item">
                <ion-label>Sets Won</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.SETS_WON"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Games Won</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.GAMES_WON"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Aces</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.ACES"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Double Faults</ion-label>
                <ion-input type="number" class="textright"
                    [(ngModel)]="result_json.AWAY_TEAM.DOUBLE_FAULTS"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>First Serve %</ion-label>
                <ion-input type="text" class="textright"
                    [(ngModel)]="result_json.AWAY_TEAM.FIRST_SERVE_PERCENTAGE"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Winners</ion-label>
                <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.WINNERS"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Unforced Errors</ion-label>
                <ion-input type="number" class="textright"
                    [(ngModel)]="result_json.AWAY_TEAM.UNFORCED_ERRORS"></ion-input>
            </ion-item>

            <ion-item class="input_item">
                <ion-label>Break Points Won</ion-label>
                <ion-input type="number" class="textright"
                    [(ngModel)]="result_json.AWAY_TEAM.BREAK_POINTS_WON"></ion-input>
            </ion-item>
        </div>

        <div class="popup-buttons">
            <button ion-button class="timekare-primary-btn" (click)="isAwayStatsPopupVisible=false">Cancel</button>
            <button ion-button class="timekare-primary-btn" (click)="updateAwayTeamStats()">Update</button>
        </div>
    </div>
</div>