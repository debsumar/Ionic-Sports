<!--
  Generated template for the PublishresultPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-navbar color="primary">
    <ion-title>⚽ Football Summary</ion-title>
  </ion-navbar>
</ion-header>

<ion-content class="football-summary-content">
  <!-- Match Header -->
  <div class="match-header">
    <div class="match-title">
      <h2>{{matchTitle}}</h2>
    </div>
    <div class="match-details">
      <div class="detail-item">
        <ion-icon name="calendar" color="primary"></ion-icon>
        <span>{{matchDate}}</span>
      </div>
      <div class="detail-item" *ngIf="matchLocation">
        <ion-icon name="pin" color="primary"></ion-icon>
        <span>{{matchLocation}}</span>
      </div>
    </div>
  </div>

  <!-- Score Section -->
  <div class="score-section">
    <!-- Home Team -->
    <div class="team-card" (click)="gotoScoreInputPage(true)">
      <div class="team-logo-container">
        <img class="team-logo" [src]="homeTeamLogo" [alt]="homeTeamName + ' logo'">
      </div>
      <div class="team-details">
        <div class="team-name">{{homeTeamName}}</div>
        <div class="team-score">{{homeScore}}</div>
        <div class="scorers" *ngIf="scorerObjectsHome && scorerObjectsHome.length > 0">
          <div class="scorer-info" *ngFor="let scorer of scorerObjectsHome">
            {{scorer?.PLAYER}}<span *ngIf="scorer?.TIME">({{scorer?.TIME}}')</span>
          </div>
        </div>
      </div>
    </div>

    <!-- VS Section -->
    <div class="vs-container" (click)="gotoResultInputPage()">
      <div class="vs-text">VS</div>
      <ion-icon name="create" class="vs-edit-icon"></ion-icon>
    </div>

    <!-- Away Team -->
    <div class="team-card" (click)="gotoScoreInputPage(false)">
      <div class="team-details away">
        <div class="team-name">{{awayTeamName}}</div>
        <div class="team-score">{{awayScore}}</div>
        <div class="scorers" *ngIf="scorerObjectsAway && scorerObjectsAway.length > 0">
          <div class="scorer-info" *ngFor="let scorer of scorerObjectsAway">
            {{scorer?.PLAYER}}<span *ngIf="scorer?.TIME">({{scorer?.TIME}}')</span>
          </div>
        </div>
      </div>
      <div class="team-logo-container">
        <img class="team-logo" [src]="awayTeamLogo" [alt]="awayTeamName + ' logo'">
      </div>
    </div>
  </div>

  <!-- POTM Section -->
  <div class="potm-section" (click)="gotoPotmPage()">
    <div class="section-header">
      <ion-icon name="trophy" color="warning"></ion-icon>
      <h4>Player of the Match</h4>
      <ion-icon name="create" class="edit-icon"></ion-icon>
    </div>
    <div class="potm-content" *ngIf="potmDisplayNames && potmDisplayNames.length > 0">
      <div class="potm-players">
        <div class="potm-player" *ngFor="let potm of potmDisplayNames">
          <ion-icon name="star" color="warning"></ion-icon>
          <span>{{potm.PLAYER}}</span>
        </div>
      </div>
    </div>
    <div class="no-potm" *ngIf="!potmDisplayNames || potmDisplayNames.length === 0">
      <ion-icon name="add-circle" color="medium"></ion-icon>
      <span>Select Player of the Match</span>
    </div>
  </div>

  <!-- Match Stats Section -->
  <div class="stats-section" *ngIf="result_json">
    <div class="section-header">
      <ion-icon name="analytics" color="secondary"></ion-icon>
      <h4>Match Statistics</h4>
    </div>

    <!-- Possession Chart -->
    <div class="possession-section">
      <div class="possession-header">
        <h5>Possession</h5>
      </div>
      <div class="possession-chart">
        <div class="possession-item" (click)="isHomeStatsPopupVisible = true">
          <span class="possession-value home">{{homePoss}}%</span>
          <ion-icon name="create" class="edit-icon"></ion-icon>
        </div>
        <canvas #doughnutCanvas width="200" height="200"></canvas>
        <div class="possession-item" (click)="isAwayStatsPopupVisible = true">
          <span class="possession-value away">{{awayPoss}}%</span>
          <ion-icon name="create" class="edit-icon"></ion-icon>
        </div>
      </div>
    </div>

    <div class="stats-grid">

      <!-- Shots On Goal Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="football" color="success"></ion-icon>
          <span class="stat-title">Shots On Goal</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.SHOTS_ON_GOAL, result_json.AWAY_TEAM.SHOTS_ON_GOAL, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.SHOTS_ON_GOAL || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.SHOTS_ON_GOAL, result_json.AWAY_TEAM.SHOTS_ON_GOAL, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.SHOTS_ON_GOAL || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Total Shots Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="radio-button-on" color="primary"></ion-icon>
          <span class="stat-title">Total Shots</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.SHOTS, result_json.AWAY_TEAM.SHOTS, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.SHOTS || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.SHOTS, result_json.AWAY_TEAM.SHOTS, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.SHOTS || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Corners Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="flag" color="warning"></ion-icon>
          <span class="stat-title">Corners</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.CORNERS, result_json.AWAY_TEAM.CORNERS, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.CORNERS || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.CORNERS, result_json.AWAY_TEAM.CORNERS, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.CORNERS || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Fouls Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="warning" color="danger"></ion-icon>
          <span class="stat-title">Fouls Committed</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.FOULS_COMMITTED, result_json.AWAY_TEAM.FOULS_COMMITTED, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.FOULS_COMMITTED || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.FOULS_COMMITTED, result_json.AWAY_TEAM.FOULS_COMMITTED, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.FOULS_COMMITTED || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Yellow Cards Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="square" color="warning" style="color: #f1c40f !important;"></ion-icon>
          <span class="stat-title">Yellow Cards</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.YELLOW_CARD, result_json.AWAY_TEAM.YELLOW_CARD, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.YELLOW_CARD || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.YELLOW_CARD, result_json.AWAY_TEAM.YELLOW_CARD, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.YELLOW_CARD || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Red Cards Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="square" color="danger"></ion-icon>
          <span class="stat-title">Red Cards</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.RED_CARD, result_json.AWAY_TEAM.RED_CARD, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.RED_CARD || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.RED_CARD, result_json.AWAY_TEAM.RED_CARD, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.RED_CARD || '0'}}</span>
          </div>
        </div>
      </div>

      <!-- Offsides Section -->
      <div class="stat-card">
        <div class="stat-header">
          <ion-icon name="hand" color="medium"></ion-icon>
          <span class="stat-title">Offsides</span>
        </div>
        <div class="stat-bars">
          <div class="stat-bar home" (click)="isHomeStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.OFFSIDES, result_json.AWAY_TEAM.OFFSIDES, 'HOME_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.HOME_TEAM.OFFSIDES || '0'}}</span>
          </div>
          <div class="stat-bar away" (click)="isAwayStatsPopupVisible = true">
            <div class="bar-container">
              <div class="bar-fill"
                [style.width.%]="getPercentage(result_json.HOME_TEAM.OFFSIDES, result_json.AWAY_TEAM.OFFSIDES, 'AWAY_TEAM')">
              </div>
            </div>
            <span class="stat-value">{{result_json.AWAY_TEAM.OFFSIDES || '0'}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>




<!-- Custom popup for home team stats update -->
<div class="custom-popup" *ngIf="isHomeStatsPopupVisible && result_json">
  <div class="popup-container">
    <div class="popup-header">
      <h3>Update {{homeTeamName}} Stats</h3>
      <button class="close-button" (click)="isHomeStatsPopupVisible=false">×</button>
    </div>

    <div class="popup-content">
      <ion-item class="input_item">
        <ion-label>Possession</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="homePoss"
          (ionInput)="onHomePossessionChange()"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Shots on Goal</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.SHOTS_ON_GOAL"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Shot Attempts</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.SHOTS"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Corners</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.CORNERS"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Fouls Committed</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.FOULS_COMMITTED"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Offsides</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.OFFSIDES"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Yellow Cards</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.YELLOW_CARD"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Red Cards</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.HOME_TEAM.RED_CARD"></ion-input>
      </ion-item>
    </div>

    <div class="popup-buttons">
      <button ion-button class="timekare-primary-btn" (click)="isHomeStatsPopupVisible=false">Cancel</button>
      <button ion-button class="timekare-primary-btn" (click)="updateHomeTeamStats()">Update</button>
    </div>
  </div>
</div>

<!-- Custom popup for away team stats update -->
<div class="custom-popup" *ngIf="isAwayStatsPopupVisible && result_json">
  <div class="popup-container">
    <div class="popup-header">
      <p>
        <span>Update</span>
        <span style="font-weight: bold; font-size: 20px;">
          {{awayTeamName}}
        </span>
      </p>
      <button class="close-button" (click)="isAwayStatsPopupVisible=false">×</button>
    </div>

    <div class="popup-content">
      <ion-item class="input_item">
        <ion-label>Possession</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="awayPoss"
          (ionInput)="onAwayPossessionChange()"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Shots on Goal</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.SHOTS_ON_GOAL"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Shot Attempts</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.SHOTS"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Corners</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.CORNERS"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Fouls Committed</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.FOULS_COMMITTED"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Offsides</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.OFFSIDES"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Yellow Cards</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.YELLOW_CARD"></ion-input>
      </ion-item>

      <ion-item class="input_item">
        <ion-label>Red Cards</ion-label>
        <ion-input type="number" class="textright" [(ngModel)]="result_json.AWAY_TEAM.RED_CARD"></ion-input>
      </ion-item>
    </div>

    <div class="popup-buttons">
      <button ion-button class="timekare-primary-btn" (click)="isAwayStatsPopupVisible=false">Cancel</button>
      <button ion-button class="timekare-primary-btn" (click)="updateAwayTeamStats()">Update</button>
    </div>
  </div>
</div>

<!-- <ion-footer>
  <ion-grid>
    <ion-row>
      <ion-col col-12>
        <button class="foobtn" ion-button block (click)="publishResult()">Publish Result</button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-footer> -->